===================================
Search Engine Multi Image Thumbnail
===================================

.. 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! source digest: sha256:9e85a1605ac18dfb01ffa0f7c4864e227f61919d76b420bc140507ed4e9cadd5
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Alpha-red.png
    :target: https://odoo-community.org/page/development-status
    :alt: Alpha
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fsearch--engine-lightgray.png?logo=github
    :target: https://github.com/OCA/search-engine/tree/16.0/search_engine_image_thumbnail
    :alt: OCA/search-engine
.. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
    :target: https://translation.odoo-community.org/projects/search-engine-16-0/search-engine-16-0-search_engine_image_thumbnail
    :alt: Translate me on Weblate
.. |badge5| image:: https://img.shields.io/badge/runboat-Try%20me-875A7B.png
    :target: https://runboat.odoo-community.org/builds?repo=OCA/search-engine&target_branch=16.0
    :alt: Try me on Runboat

|badge1| |badge2| |badge3| |badge4| |badge5|

This module is a technical module with the purpose of easing the export
of image thumbnails to a search engine index.

It extends the functionality of the ``connector_search_engine`` module
by adding specialized methods that can be used to get and generate
thumbnails from an image you want to index.

.. IMPORTANT::
   This is an alpha version, the data model and design can change at any time without warning.
   Only for development or testing purpose, do not use in production.
   `More details on development status <https://odoo-community.org/page/development-status>`_

**Table of contents**

.. contents::
   :local:

Use Cases / Context
===================

When you export images to an index, you may want to ensure that the
images are exported in a format and size that is suitable for the
application that will consume the index.

This module depends on the
`fs_image_thumdbnail <https://github.com/oca/storage/tree/16.0/fs_image_thumbnail>`__
module. This last one provides a method and a mixin used to generate
thumbnails from a ``FSImageValue`` object.

Configuration
=============

If you want to force the format of the generated thumbnail, you define a
a configuration parameter into Odoo with the key
``fs_image_thumbnail.resize_format`` and the value PNG or JPEG or GIF or
ICO. Otherwise, the format of the generated thumbnail will be the same
as the format of the original image.

Usage
=====

As specified, this module will not add any new features by itself once
installed. As a developer, you can depend on this module to benefit from
a set of specialized methods that can be used to get and generate
thumbnails from an image you want to index.

Behind the scenes, this module extend the ``se.indexable.recor`` model
by adding 2 new methods:

-  ``_get_or_create_thumbnails_for_multi_images``: This method is used
   to get or create thumbnails for a set of images.
-  ``_get_or_create_thumbnails_for_image``: This method is used to get
   or create thumbnails for a single image.

Thanks to these methods, you can easily generate thumbnails for images
stored into odoo through three different ways:

-  A relational field referencing record inheriting from
   ``fs.image.relation.mixin``.
-  An odoo's Image field.
-  An FSImage field.

The sizes of the thumbnails generated by these methods are configured
through the creation of a new record into the ``se.thumbnail.size``
model. This model allows you to define the size of thumbnails by search
engine backend, model and field. For example, you can define that you
want to generate thumbnails of size ``100x100`` for all the images
stored into the ``product.template`` model and the ``image`` field when
you export them to the ``opensearch_xyz`` backend. In this way, you can
easily define different thumbnail sizes for different search engine
backends, models and fields according to your needs.

Thumbnails are always retrieved and generated for one image and a
specific ``base_name``. The base name is used as a key to identify the
thumbnails from an image related to a usage and also as base name for
the file name of the thumbnails generated. By default, the ``base_name``
is computed from the display name of the record that contains the image
to ensure a good SEO. To avoid problems with special characters, the
``base_name`` is normalized before being used.

Here is an example of how to use these methods:

.. code:: python


   from odoo import models, fields
   from odoo.addons.fs_imeage.fields import FSImage


   class ProductImageRelation(models.Model):
       _name = "product.image.relation"
       _inherit = ["fs.image.relation.mixin"]

       name = fields.Char(required=True)
       product_id = fields.Many2one(
           "product.product",
           required=True,
           ondelete="cascade",
       )


   class ProductProduct(models.Model):
       _name = "product.product"
       _inherit = ["se.indexable.record", "product.product"]

       name = fields.Char(required=True)
       image = fields.Image(required=True)
       image_ids = fields.One2many(
           "product.image.relation",
           "product_id",
           string="Images",
       )
       fs_image = FSImage(required=True)



   # A creation is always done for a given se.index record.
   index = self.env["se.index"].browse(1)
   product = self.env["product.product"].browse(1)

   # Get or create thumbnails for a single image
   for (thumbnail_size, thumbnail) in product._get_or_create_thumbnails_for_image(
       index,
       field_name="image",
       ):
       # Do something with the thumbnail
       print(f"Thumbnail  for image with size {thumbnail_size.display_name} "
           "is available at url {thumbnail.image.url}")

   # Get or create thumbnails for a single image
   for (thumbnail_size, thumbnail) in product._get_or_create_thumbnails_for_image(
       index,
       field_name="fs_image",
       ):
       # Do something with the thumbnail
       print(f"Thumbnail for fs_image with size {thumbnail_size.display_name} "
           "is available at url {thumbnail.image.url}")


   # Get or create thumbnails for a set of images
   thumbnails_by_image = product._get_or_create_thumbnails_for_multi_images(
       index,
       field_name="image_ids",
       )

   for (image, thumbnails) in thumbnails_by_image.items():
       for (thumbnail_size, thumbnail) in thumbnails:
           # Do something with the thumbnail
           print(f"Thumbnail for image {image.name} with size "
               "{thumbnail_size.display_name} is available at url "
               "{thumbnail.image.url}")

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/search-engine/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
`feedback <https://github.com/OCA/search-engine/issues/new?body=module:%20search_engine_image_thumbnail%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
-------

* ACSONE SA/NV

Contributors
------------

-  Laurent Mignon laurent.mignon@acsone.eu (https://www.acsone.eu/)

Other credits
-------------

The development of this module has been financially supported by:

-`Alcyon Belux <https://www.alcyonbelux.be/>`__

Maintainers
-----------

This module is maintained by the OCA.

.. image:: https://odoo-community.org/logo.png
   :alt: Odoo Community Association
   :target: https://odoo-community.org

OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.

.. |maintainer-lmignon| image:: https://github.com/lmignon.png?size=40px
    :target: https://github.com/lmignon
    :alt: lmignon

Current `maintainer <https://odoo-community.org/page/maintainer-role>`__:

|maintainer-lmignon| 

This module is part of the `OCA/search-engine <https://github.com/OCA/search-engine/tree/16.0/search_engine_image_thumbnail>`_ project on GitHub.

You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
